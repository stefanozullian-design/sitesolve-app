<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiteSolve - Participant</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white p-6">
    <h1 id="title" class="text-2xl font-black text-blue-500 mb-6 italic">CONNECTING...</h1>
    
    <div id="content" class="space-y-6">
        <div>
            <p class="text-[10px] font-bold text-gray-500 uppercase mb-2">1. Select Step</p>
            <div id="steps" class="flex gap-2 flex-wrap"></div>
        </div>
        <div>
            <p class="text-[10px] font-bold text-gray-500 uppercase mb-2">2. Select Category</p>
            <div id="cats" class="flex gap-2 flex-wrap"></div>
        </div>
        <textarea id="note" class="w-full bg-gray-900 p-4 rounded-xl border border-gray-800 outline-none focus:border-blue-500" placeholder="Your observation..."></textarea>
        <button onclick="send()" class="w-full bg-blue-600 py-4 rounded-xl font-black uppercase">Send</button>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyDY7diMSCZc0z2ih1fa2FLx4D47t3LJCIw", 
            authDomain: "issues-app-65527.firebaseapp.com", 
            databaseURL: "https://issues-app-65527-default-rtdb.firebaseio.com", 
            projectId: "issues-app-65527", 
            storageBucket: "issues-app-65527.firebasestorage.app", 
            messagingSenderId: "103649380899", 
            appId: "1:103649380899:web:f8f9131b9a4123d2e93f96" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const room = new URLSearchParams(window.location.search).get('room');
        let selStep = "", selCat = "", catColor = "";

        if(room) {
            db.ref(`rooms/${room}/config`).on('value', snap => {
                const conf = snap.val();
                if(!conf) return;
                document.getElementById('title').innerText = conf.title;
                document.getElementById('steps').innerHTML = conf.steps.map(s => `<button onclick="selStep='${s}'" class="bg-gray-800 px-4 py-2 rounded-lg text-xs focus:bg-blue-600">${s}</button>`).join('');
                document.getElementById('cats').innerHTML = conf.cats.map(c => `<button onclick="selCat='${c.name}';catColor='${c.color}'" class="bg-gray-800 px-4 py-2 rounded-lg text-xs focus:bg-blue-600">${c.name}</button>`).join('');
            });
        }

        function send() {
            const text = document.getElementById('note').value;
            if(!selStep || !selCat || !text) return alert("Fill everything!");
            db.ref(`rooms/${room}/notes`).push({ text, step: selStep, category: selCat, color: catColor }).then(() => {
                document.getElementById('note').value = "";
                alert("Sent!");
            });
        }
    </script>
</body>
</html>
